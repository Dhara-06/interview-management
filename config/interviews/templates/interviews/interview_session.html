<!DOCTYPE html>
<html>
<head>
    <title>Interview Session</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

</head>
<body class="bg-light">
<div class="container mt-5">

<h2>{{ interview.title }}</h2>

<p><strong>AI Interview Question:</strong></p>
<p class="fw-bold">
    Question {{ current_question }} of {{ total_questions }}
</p>

<div class="progress mb-3">
    <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated"
         role="progressbar"
         data-progress="{{ progress|default:0 }}"
         aria-valuenow="{{ progress|default:0 }}"
         aria-valuemin="0"
         aria-valuemax="100">
        {{ progress }}%
    </div>
</div>

<div style="margin-bottom:12px;">
    <strong>Time left for this question:</strong>
    <span id="timer" style="font-size:1.1em;color:#d9534f;">--:--</span>
    <small>(auto-submits when time expires)</small>
</div>

<p>{{ question }}</p>

<form method="post">
    {% csrf_token %}

    <!-- IMPORTANT: store the question -->
    <input type="hidden" name="question" value="{{ question }}">

    <textarea
        name="answer"
        rows="6"
        cols="60"
        placeholder="Type your answer here..."
        required>
    </textarea>

    <br><br>

    <button type="submit">Submit Answer</button>
</form>

<script>
// Timer per question (seconds). You can adjust defaultSeconds as needed.
const defaultSeconds = 120;
let seconds = defaultSeconds;

function formatTime(s){
    const mm = String(Math.floor(s/60)).padStart(2,'0');
    const ss = String(s%60).padStart(2,'0');
    return mm+':'+ss;
}

const timerEl = document.getElementById('timer');
timerEl.textContent = formatTime(seconds);

const interval = setInterval(()=>{
    seconds -= 1;
    timerEl.textContent = formatTime(seconds);
    if(seconds <= 0){
        clearInterval(interval);
        // If textarea is empty, insert note then submit
        const ta = document.querySelector('textarea[name="answer"]');
        if(ta && !ta.value.trim()) ta.value = '(no answer submitted)';
        // submit the form
        document.querySelector('form').submit();
    }
}, 1000);
</script>

<script>
// Apply progress width from data attribute to avoid template braces in CSS
(function(){
    const pb = document.getElementById('progress-bar');
    if(pb){
        const p = Number(pb.getAttribute('data-progress') || 0);
        pb.style.width = p + '%';
        pb.setAttribute('aria-valuenow', String(p));
    }
})();
</script>

<br>
<a href="{% url 'candidate_dashboard' %}">Exit Interview</a>
</div>
</body>
</html>

