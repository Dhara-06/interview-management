<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interview Session</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
</head>
<body class="bg-light">
    <div class="container mt-4">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">{{ interview.title }}</h3>
                    <span class="badge bg-light text-primary">
                        <i class="bi bi-chat-dots me-1"></i>
                        Question {{ current_question }} of {{ total_questions }}
                    </span>
                </div>
            </div>
            
            <div class="card-body">
             
                <div class="mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="text-muted">Progress</span>
                        <span class="text-muted">{{ progress }}%</span>
                    </div>
                    <div class="progress">
                        <div id="progress-bar" 
                             class="progress-bar progress-bar-striped progress-bar-animated bg-success"
                             role="progressbar"
                             data-progress="{{ progress|default:0 }}"
                             aria-valuenow="{{ progress|default:0 }}"
                             aria-valuemin="0"
                             aria-valuemax="100">
                        </div>
                    </div>
                </div>

                
                <div class="alert alert-warning d-flex align-items-center mb-4">
                    <i class="bi bi-clock-fill me-2"></i>
                    <div>
                        <strong>Time left:</strong>
                        <span id="timer" class="fw-bold text-danger ms-2">--:--</span>
                        <div class="small text-muted">(auto-submits when time expires)</div>
                    </div>
                </div>

             
                <div class="mb-4">
                    <h5 class="mb-3">
                        <i class="bi bi-question-circle me-2 text-primary"></i>
                        AI Interview Question
                    </h5>
                    <div class="border-start border-4 border-primary ps-3 bg-light p-3">
                        <p class="mb-0">{{ question }}</p>
                    </div>
                </div>

              
                <form method="post" id="answer-form">
                    {% csrf_token %}
                    
                    <input type="hidden" name="question" value="{{ question }}">

                    <div class="mb-3">
                        <label for="answer" class="form-label fw-bold">
                            <i class="bi bi-pencil-square me-1"></i>Your Answer
                        </label>
                        <textarea
                            id="answer"
                            name="answer"
                            class="form-control"
                            rows="6"
                            placeholder="Type your answer here..."
                            required>
                        </textarea>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{% url 'candidate_dashboard' %}" 
                           class="btn btn-outline-secondary"
                           onclick="return confirm('Are you sure you want to exit the interview?')">
                            <i class="bi bi-box-arrow-left me-1"></i>Exit Interview
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-send me-1"></i>Submit Answer
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
    
    const defaultSeconds = 120;
    let seconds = defaultSeconds;
    const timerEl = document.getElementById('timer');

    function formatTime(s){
        const mm = String(Math.floor(s/60)).padStart(2,'0');
        const ss = String(s%60).padStart(2,'0');
        return mm+':'+ss;
    }

    timerEl.textContent = formatTime(seconds);

    const interval = setInterval(()=>{
        seconds -= 1;
        timerEl.textContent = formatTime(seconds);
        
        if(seconds <= 0){
            clearInterval(interval);
            const ta = document.querySelector('textarea[name="answer"]');
            if(ta && !ta.value.trim()) {
                ta.value = '(no answer submitted)';
            }
            document.getElementById('answer-form').submit();
        }
    }, 1000);

    // Focus textarea and position cursor at the beginning
    document.addEventListener('DOMContentLoaded', function() {
        const answerTextarea = document.getElementById('answer');
        if (answerTextarea) {
            // Focus the textarea
            answerTextarea.focus();
            // Set cursor position to the beginning
            answerTextarea.setSelectionRange(0, 0);
        }
    });

   
    (function(){
        const pb = document.getElementById('progress-bar');
        if(pb){
            const p = Number(pb.getAttribute('data-progress') || 0);
            pb.style.width = p + '%';
            pb.setAttribute('aria-valuenow', String(p));
        }
    })();
    </script>
</body>
</html>

